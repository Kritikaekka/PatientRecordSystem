<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Patient Record System</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Patient Record System</h1>

  <section>
    <h2>Add Patient</h2>
    <form id="patientForm">
      <input type="text" id="name" placeholder="Name" required /><br> 
      <select id="gender" required>
        <option value="">Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
      <input type="date" id="dob" required />
      <input type="text" id="contact_number" placeholder="Contact Number" />
      <input type="text" id="address" placeholder="Address" />
      <textarea id="medical_history" placeholder="Medical History"></textarea>
      <button type="submit">Add Patient</button>
    </form>
  </section>

  <section>
    <h2>Patients List</h2>
    <table id="patientsTable" border="1">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Gender</th>
          <th>DOB</th>
          <th>Contact</th>
          <th>Address</th>
          <th>History</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    const backendUrl = 'https://patientrecordsystem-1.onrender.com';


    function loadPatients() {
      fetch(`${backendUrl}/patients`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#patientsTable tbody');
          tbody.innerHTML = '';
          data.forEach(p => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${p.patient_id}</td>
              <td>${p.name}</td>
              <td>${p.gender}</td>
              <td>${p.dob ? p.dob.substring(0, 10) : ''}</td>
              <td>${p.contact_number}</td>
              <td>${p.address}</td>
              <td>${p.medical_history}</td>
              <td><button class="delete-btn" onclick="deletePatient(${p.patient_id})">Delete</button></td>
            `;
            tbody.appendChild(row);
          });
        });
    }

    document.getElementById('patientForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const patientData = {
        name: document.getElementById('name').value,
        gender: document.getElementById('gender').value,
        dob: document.getElementById('dob').value,
        contact_number: document.getElementById('contact_number').value,
        address: document.getElementById('address').value,
        medical_history: document.getElementById('medical_history').value
      };

      fetch(`${backendUrl}/patients`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(patientData),
      })
        .then(res => res.json())
        .then(() => {
          this.reset();
          loadPatients();
        });
    });

    // Ensure global scope for delete function
    window.deletePatient = function(id) {
      fetch(`${backendUrl}/patients/${id}`, {
        method: 'DELETE'
      })
        .then(res => res.json())
        .then(data => {
          if (data.deleted > 0) {
            alert('Patient deleted successfully!');
          } else {
            alert('Could not delete patient.');
          }
          loadPatients();
        })
        .catch(() => {
          alert('Failed to delete patient. Is your backend running?');
        });
    };

    // Initial load
    loadPatients();
  </script>
</body>
</html>
